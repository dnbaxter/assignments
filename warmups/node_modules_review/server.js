var express = require("express");
var app = express();
var port = process.env.PORT || 7000;
var bodyParser = require("body-parser");
app.use(bodyParser.json());

var iceCreams = [
    {
        flavor: "Rocky Road",
        calories: 10,
        rating: 7.4
    },
    {
        flavor: "Mint Chocolate Chip",
        calories: 300,
        rating: 8.2
    },
    {
        flavor: "Chocolate Chip Cookie Dough",
        calories: 450,
        rating: 8.8
    },
    {
        flavor: "Peanut Butter Chocolate",
        calories: 550,
        rating: 8.8
    }
];


/*
REST

GET /ice-cream => array of all ice cream
POST /ice-cream => add a new ice cream to the array of ice cream
GET /ice-cream/:flavor => single ice cream instance
PUT /ice-cream/:flavor => Update an ice cream instance
DELETE /ice-cream/:flavor
*/


app.get("/ice-cream", function (req, res) {
    
    if (req.query.minRating) {
        var filteredIceCreams = iceCreams.filter(function(obj) {
            return obj.rating >= req.query.minRating;
        });
        return res.send(filteredIceCreams);
    }

    return res.send(iceCreams);

});

app.post("/ice-cream", function (req, res) {

    console.log("Posted");
    iceCreams.push(req.body);
    return res.send("Posted new ice cream!");

});

app.get("/ice-cream/:flavor", function(req, res) {
    
    iceCreams.forEach(function(iceCream) {
        if (req.params.flavor.toLowerCase() === iceCream.flavor.toLowerCase()) {
            return res.send(iceCream);
        }
    });
    return res.send("No ice cream by that flavor found.");
    
});









app.listen(port, function () {
    console.log("Port is running on " + port);
});
